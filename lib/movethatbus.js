"use strict";function t(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function e(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}var o={settings:{cdnUrl:"https://raw.githubusercontent.com/knogobert/movethatbus.js/master/",busSrc:"lib/img/bus.png",soundSrcs:["lib/sound/likeabus.mp3","lib/sound/movethatbus.mp3","lib/sound/engine.m4a"],amountOfTimesToLetBusLoad:1,clickedCookie:"howManyTimesDidYouMoveThatBus",visitorsCookie:!1},speed:100,state:"unmoved",sizeFactor:1,moveFactor:1,bus:new Image,_rando:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return Math.floor(Math.random()*(e-t+1)+t)},createCanvas:function(){var t=document.createElement("canvas");return t.width=1024,t.height=768,t.id="movethatbus",t.style.width="100%",t.style.height="100vh",t.style.objectFit="cover",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.overflow="hidden",t.style.zIndex="9999",t},draw:function(t){var e=t.getContext("2d"),o=new Date;this.sizeFactor="moving"===this.state?1.1*this.sizeFactor:this.sizeFactor,this.moveFactor="moving"===this.state?1.12*this.moveFactor:this.moveFactor,e.globalCompositeOperation="destination-over",e.clearRect(0,0,t.width,t.height),e.save(),e.translate(t.width/2,t.height/2),e.rotate(1e-5*this._rando(-2,2)*o.getMilliseconds()),e.translate(-t.width/2,-t.height/2),e.drawImage(this.bus,this._rando(0,2)-this.moveFactor,this._rando(0,2),t.width+this.sizeFactor,t.height+this.sizeFactor),e.restore()},init:function(o){var r=this;this.settings=function(o){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){t(o,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(i,t))}))}return o}({},this.settings,{},o);var i=!this.settings.visitorsCookie||!!localStorage.getItem(this.settings.visitorsCookie),n=Number(localStorage.getItem(this.settings.clickedCookie))||0;if(i&&n<this.settings.amountOfTimesToLetBusLoad){console.info("initThatBus");var s=0,a=0;this.bus.src="".concat(this.settings.cdnUrl).concat(this.settings.busSrc);var c=this.settings.soundSrcs.map((function(t){return new Audio("".concat(r.settings.cdnUrl).concat(t))})),u=this.createCanvas();document.body.appendChild(u),u.addEventListener("click",(function(){c.every((function(t){return t.readyState>=3}))&&0===s&&(c.forEach((function(t){return t.play()})),s++,localStorage.setItem(r.settings.clickedCookie,"".concat(++n||s)),r.state="moving",setTimeout((function(){u.remove(),clearInterval(r.drawInterval)}),7e3)),++a>=5&&(c.forEach((function(t){return t.pause()})),u.remove(),clearInterval(r.drawInterval))}),!1),this.bus.onload=function(){r.drawInterval=setInterval((function(){return r.draw(u)}),r.speed)}}}};document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector("[data-movethatbus]");if(t){var e,r=t.getAttribute("data-movethatbus").replace(/'/g,'"');try{e=r&&JSON.parse(r)}catch(t){return void console.error('Error parsing supplied "data-movethatbus" value, it is not valid JSON (make sure you use quoted object keys).\n',t)}o.init(e)}})),module.exports=o;
