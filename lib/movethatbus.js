"use strict";function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function e(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}var s={settings:{cdnUrl:"https://raw.githubusercontent.com/knogobert/movethatbus.js/master/",busSrc:"lib/img/bus.png",soundSrcs:["lib/sound/likeabus.mp3","lib/sound/movethatbus.mp3","lib/sound/engine.m4a"],amountOfTimesToLetBusLoad:1,clickedCookie:"howManyTimesDidYouMoveThatBus",visitorsCookie:!1,startDate:"",endDate:""},speed:100,state:"unmoved",sizeFactor:1,moveFactor:1,bus:new Image,_rando:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return Math.floor(Math.random()*(e-t+1)+t)},createCanvas:function(){var t=document.createElement("canvas");return t.width=1024,t.height=768,t.id="movethatbus",t.style.width="100%",t.style.height="100vh",t.style.objectFit="cover",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.overflow="hidden",t.style.zIndex="9999",t},draw:function(t){var e=t.getContext("2d"),s=new Date;this.sizeFactor="moving"===this.state?1.1*this.sizeFactor:this.sizeFactor,this.moveFactor="moving"===this.state?1.12*this.moveFactor:this.moveFactor,e.globalCompositeOperation="destination-over",e.clearRect(0,0,t.width,t.height),e.save(),e.translate(t.width/2,t.height/2),e.rotate(1e-5*this._rando(-2,2)*s.getMilliseconds()),e.translate(-t.width/2,-t.height/2),e.drawImage(this.bus,this._rando(0,2)-this.moveFactor,this._rando(0,2),t.width+this.sizeFactor,t.height+this.sizeFactor),e.restore()},init:function(s){var o=this;this.settings=function(s){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?e(Object(r),!0).forEach((function(e){t(s,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))}))}return s}({},this.settings,{},s);var r=!this.settings.visitorsCookie||!!localStorage.getItem(this.settings.visitorsCookie),i=Number(localStorage.getItem(this.settings.clickedCookie))||0,n=!0;if(this.settings.startDate&&this.settings.endDate){var a=Date.now(),c=new Date(this.settings.startDate).setHours(0,0,0,0);n=a<=new Date(this.settings.endDate).setHours(0,0,0,0)&&a>=c}if(r&&n&&i<this.settings.amountOfTimesToLetBusLoad){console.info("initThatBus");var u=0,h=0;this.bus.src="".concat(this.settings.cdnUrl).concat(this.settings.busSrc);var d=this.settings.soundSrcs.map((function(t){return new Audio("".concat(o.settings.cdnUrl).concat(t))})),l=this.createCanvas();document.body.appendChild(l),l.addEventListener("click",(function(){d.every((function(t){return t.readyState>=3}))&&0===u&&(d.forEach((function(t){return t.play()})),u++,localStorage.setItem(o.settings.clickedCookie,"".concat(++i||u)),o.state="moving",setTimeout((function(){l.remove(),clearInterval(o.drawInterval)}),7e3)),++h>=5&&(d.forEach((function(t){return t.pause()})),l.remove(),clearInterval(o.drawInterval))}),!1),this.bus.onload=function(){o.drawInterval=setInterval((function(){return o.draw(l)}),o.speed)}}}};document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector("[data-movethatbus]");if(t){var e,o=t.getAttribute("data-movethatbus").replace(/'/g,'"');try{e=o&&JSON.parse(o)}catch(t){return void console.error('Error parsing supplied "data-movethatbus" value, it is not valid JSON (make sure you use quoted object keys).\n',t)}s.init(e)}})),module.exports=s;
